# 男朋友养成计划 V3.6 Cloud ❤️

这是一个专为情侣设计的互动网页应用，包含甜蜜积分、愿望清单、恋爱商店、**温馨相册**、**姨妈助手**、**年度计划**等功能，并支持云端数据同步。

## 🏗️ 软件架构说明 (Software Architecture)

本项目采用 **MPA (多页应用)** 架构，经过 V4.x 版本的模块化重构，实现了核心逻辑与 UI 的解耦，提高了代码的可维护性和扩展性。

### 1. 核心模块 (`js/core/`)
*   **`storage.js`**: **数据持久化层**。统一封装 `localStorage` (本地) 和 `LeanCloud` (云端) 的读写操作，负责处理复杂的数据同步、合并与冲突解决逻辑。
*   **`utils.js`**: **工具函数库**。包含日期格式化、ID 生成、防抖节流等通用纯函数。
*   **`constants.js`**: **静态配置中心**。集中管理游戏文案、商品列表、每日情话、等级规则等静态数据，方便运营维护。
*   **`sound-manager.js`**: **音效引擎**。基于 Web Audio API 的独立模块，支持多种音效风格（清脆、击鼓、电子等）切换。

### 2. UI 模块 (`js/ui/`)
*   **`ui-manager.js`**: **视觉表现层**。负责全局通用的 UI 组件，如 Toast 提示、弹窗管理、樱花飘落特效、动态桌面图标生成等。

### 3. 业务逻辑层
*   **`common.js`**: **业务控制器 (Controller)**。作为胶水层，负责组装 Core 和 UI 模块，处理用户交互事件（如签到、购买、积分变更），不再包含底层实现细节。
*   **页面脚本**: 各个 HTML 页面（如 `index.html`, `games.html`）仅包含少量的初始化代码和特定页面的交互逻辑。

### 4. 视图层 (View)
*   **HTML/CSS**: 采用标准的 HTML5 和 CSS3 (Variables) 构建，`common.css` 提供全局样式系统，`themes.css` 支持多套主题切换。

### 5. 目录结构
```text
root/
  ├─ js/
  │  ├─ core/           # 核心逻辑模块
  │  │  ├─ constants.js # 静态配置
  │  │  ├─ sound-manager.js # 音效管理
  │  │  ├─ storage.js   # 数据存储与同步
  │  │  └─ utils.js     # 工具函数
  │  ├─ ui/             # UI 模块
  │  │  └─ ui-manager.js # UI 管理器
  │  ├─ game2048.js     # 2048 游戏逻辑
  │  ├─ match3.js       # 消消乐游戏逻辑
  │  └─ sudoku.js       # 数独游戏逻辑
  ├─ common.js          # 全局业务控制器
  ├─ common.css         # 全局样式
  └─ *.html             # 各个功能页面
```

---

## 📁 项目结构

本项目已拆分为多个HTML页面，便于在GitHub Pages上部署和访问：

- **`index.html`** - 主页面（积分系统、每日签到、加减分功能）
- **`wishlist.html`** - 愿望清单页面（记录和完成恋爱愿望）
- **`album.html`** - 温馨相册页面（拍立得风格照片管理）
- **`shop.html`** - 恋爱商店页面（兑换中心和背包系统）
- **`games.html`** - 游戏中心页面（消消乐、2048等小游戏）
- **`plan.html`** - 年度计划页面（分类管理、阶段性任务、内容记录）
- **`settings.html`** - 设置页面（生理期记录、云同步配置、历史记录）

### 公共资源文件

- **`common.css`** - 所有页面共享的样式文件
- **`common.js`** - 所有页面共享的JavaScript逻辑（包含数据管理、SoundManager音效系统）
- **`themes.css`** - 主题样式文件（支持多套主题切换）

### 游戏文件

- **`js/match3.js`** - 甜蜜消消乐游戏逻辑（V4.0 连击道具版）
- **`js/game2048.js`** - 2048数字合成游戏逻辑（V4.2 模块化版）
- **`js/sudoku.js`** - 数独游戏逻辑（V1.7 数独题库验证版）
- **`games.html`** - 游戏中心页面（消消乐、2048、数独等小游戏）

## ✨ 主要功能

### V4.13 姨妈助手完整功能版 🩸 (Latest)
1. **提醒功能**：
   *   **可配置提醒**：支持提前3天、2天、1天、当天提醒，可自定义提醒时间。
   *   **智能提醒**：系统自动检查是否需要提醒，并在主页显示提醒消息。
   *   **提醒开关**：可随时启用/禁用提醒功能。
2. **统计面板增强**：
   *   **周期规律性**：计算周期标准差（σ），显示周期规律性（规律/较规律/不规律）。
   *   **本月统计**：显示本月记录次数和平均周期。
   *   **本年度统计**：显示本年度记录次数和平均周期。
   *   **详细统计**：平均周期、周期范围、总记录次数等完整统计信息。
3. **预测算法**：
   *   **智能预测**：基于历史数据预测下次日期，考虑周期波动。
   *   **范围预测**：显示预计日期范围（±标准差），更准确预测。
   *   **波动考虑**：根据历史周期的标准差，给出更合理的预测范围。
4. **症状记录功能**：
   *   **疼痛程度**：记录0-5级疼痛程度（无痛/轻微/轻度/中度/重度/非常严重）。
   *   **情绪记录**：记录情绪状态（开心/正常/低落/易怒/焦虑）。
   *   **备注功能**：可添加其他症状或备注信息。
   *   **可选功能**：症状记录完全可选，不影响核心使用。
5. **UI优化**：
   *   **主页卡片增强**：显示当前周期第几天、预计下次日期、日期范围、周期规律性。
   *   **历史记录优化**：历史记录列表显示症状信息（疼痛、情绪、备注）。
   *   **快速记录**：保留"记录今天"快捷按钮，方便快速记录。
   *   **提醒设置界面**：独立的提醒配置面板，方便管理提醒设置。

### V4.12 姨妈助手UI优化 🎨
1. **折叠面板设计**：
   *   **统计信息折叠**：周期统计信息默认折叠，点击展开查看详细数据，节省页面空间。
   *   **历史记录折叠**：历史记录列表默认折叠，需要时点击展开，避免页面过长。
   *   **平滑动画**：添加折叠/展开动画效果，提升用户体验。
2. **信息密度优化**：
   *   **精简显示**：主页卡片显示更简洁，只显示核心信息（距离天数、平均周期、记录次数）。
   *   **紧凑布局**：设置页使用更紧凑的布局，统计信息采用左右对齐的键值对形式。
   *   **按钮优化**：记录按钮改为并排显示，节省垂直空间。
3. **交互优化**：
   *   **折叠状态指示**：使用箭头图标指示折叠/展开状态，点击区域更大更易操作。
   *   **记录计数显示**：在历史记录标题旁显示记录数量，一目了然。
   *   **悬停效果**：删除按钮添加悬停效果，提升交互反馈。

### V4.11 姨妈助手核心功能增强 🩸
1. **历史记录系统**：
   *   **多记录存储**：支持存储多次生理期开始日期，所有记录保存在数组中，每条记录包含日期和唯一ID。
   *   **历史记录管理**：在设置页面可以查看所有历史记录，按日期倒序排列，显示每条记录距离上次的天数。
   *   **删除功能**：支持删除错误的记录，删除后系统会自动重新计算周期统计。
2. **智能周期计算**：
   *   **自动计算平均周期**：基于历史记录自动计算平均周期天数，首次使用默认28天，有2条以上记录后自动调整。
   *   **周期范围显示**：显示最短周期、最长周期和平均周期，帮助了解周期规律性。
   *   **异常数据过滤**：自动过滤异常数据（如超过60天的间隔），确保统计准确性。
3. **日期计算优化**：
   *   **统一日期格式**：使用 `utils.getTodayStr()` 统一日期格式，避免时区问题。
   *   **精确计算**：使用本地时间 `T00:00:00` 进行计算，确保日期计算的准确性。
   *   **数据迁移**：自动将旧版本的 `periodDate` 数据迁移到新的 `periodData` 结构，保证向后兼容。
4. **UI 增强**：
   *   **主页显示优化**：显示上次记录日期、预计下次日期、距离天数，以及周期统计信息（平均/最短/最长周期）。
   *   **设置页功能完善**：添加"记录今天"快捷按钮、周期统计面板、历史记录列表，支持删除记录。
   *   **统计信息展示**：清晰展示平均周期、周期范围、已记录次数等统计信息。

### V3.6 年度计划系统 📋
1. **年度计划管理**：
   *   **分类展示**：支持7大分类（读书清单、电影清单、休闲娱乐、身体健康、日常生活、体验突破、自我提升），通过标签页切换查看，避免页面过长。
   *   **阶段性任务**：支持单次任务和阶段性任务两种类型。阶段性任务可逐步记录完成进度（如"看20部电影"）。
   *   **内容记录**：电影清单和读书清单支持记录具体内容（如看了什么电影、读了什么书），每条记录自动保存日期和时间。
   *   **进度可视化**：显示总体完成度和各分类完成情况，阶段性任务显示进度条和当前/目标数值。
   *   **灵活管理**：支持新增、删除计划，所有操作自动同步到云端。
   *   **查看记录**：可查看阶段性任务的详细记录列表，支持删除单条记录。

### V4.10 女生签到甜度保存修复 🔧
1.  **云端数据合并修复**：
    *   **甜度覆盖问题解决**：修复了云端数据同步时，女生签到后甜度被云端旧数据覆盖的问题。现在在 `handleCloudMerge` 方法中，会分别检测男生和女生的签到状态，并优先使用本地刚刚签到后的积分/甜度数据，确保签到奖励不会丢失。
    *   修复了"女生签到不加甜度积分"的严重 BUG，现在女生签到后甜度会正确保存并同步到云端。

### V4.9 签到与奖励系统底层修复 🔧
1.  **日期计算逻辑修复**：
    *   **时区问题解决**：修复了签到系统中计算连续天数时，因 `Date` 对象解析 UTC 时间导致的时区偏差。现在统一使用本地时间 `00:00:00` 进行比较，彻底解决了“明明是第二天签到却被判为断签”或“同一天内被判为签到多次”的 BUG。
    *   **跨日判定优化**：优化了日期差计算公式，使用 `Math.round` 替代 `Math.ceil`，避免微小的时间戳误差导致天数计算错误。
2.  **游戏奖励判定修复**：
    *   **Key值一致性**：修复了游戏中心在判断“今日是否已领奖”时，生成的 `localStorage` Key 日期格式可能与当前系统时间不一致的问题。现在统一调用 `utils.getTodayStr()`，确保 Key 值的唯一性和准确性。
    *   解决了“明明当天没玩过游戏（或玩了没领奖），系统却提示已领奖”的严重 BUG。

### V4.8 签到系统逻辑重构 🛠️
1.  **修复积分/甜度混淆 BUG**：
    *   修复了女生签到时错误地增加“积分 (Boy)”而非“甜度 (Girl)”的问题。现在女生签到将正确获得甜度奖励。
2.  **奖励机制优化**：
    *   **奖励叠加**：修复了“连击奖励”与“双人签到奖励”互斥的问题。现在如果某天既是连击日又是双人签到，奖励将**叠加计算**（基础奖励 + 连击奖励 + 双人加成），确保用户利益最大化。
    *   **连击大奖**：连续签到每满 7 天，基础奖励提升至 20 分/甜度。
    *   **双人加成**：双人同天签到额外 +5 分/甜度。
3.  **UI 细节优化**：
    *   签到弹窗现在会根据用户角色动态显示正确的单位（💎 积分 / 🍬 甜度）。

### V4.7 数独题库验证与体验优化 🔍
(略)

### V4.6 数独理论极限优化 🔬
(略)

### V4.5 数独 UI 极致优化 📱
(略)

### V4.4 数独答案与积分联动 💡
(略)

### V3.x 系列更新
(略，详见历史记录)

## 📱 如何安装到手机？

### 方法一：添加到主屏幕（最推荐，永久免费）🌟
这种方法不需要复杂的打包，不需要证书，体验和原生 App 几乎一样（全屏运行，无地址栏）。

1.  将所有HTML文件和公共资源文件上传到静态网站托管（GitHub Pages 等）。
2.  在手机浏览器中打开链接。
3.  点击 **分享按钮** -> **“添加到主屏幕”**。

## 🚀 GitHub Pages 部署

1. 将所有文件推送到GitHub仓库
2. 在仓库设置中启用GitHub Pages
3. 选择主分支（通常是`main`或`master`）作为源
4. 访问 `https://你的用户名.github.io/仓库名/`

## ⚠️ 注意事项
*   本项目使用了 LeanCloud 进行数据存储，请确保在设置页面中正确配置了你的 AppID 和 AppKey。

---
*Made with ❤️ for Love.*

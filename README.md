# 男朋友养成计划 V3.1 Cloud ❤️

这是一个专为情侣设计的互动网页应用，包含甜蜜积分、愿望清单、恋爱商店、**温馨相册**、**姨妈助手**等功能，并支持云端数据同步。

## 🏗️ 软件架构说明 (Software Architecture)

本项目采用 **MPA (多页应用)** 架构，经过 V4.x 版本的模块化重构，实现了核心逻辑与 UI 的解耦，提高了代码的可维护性和扩展性。

### 1. 核心模块 (`js/core/`)
*   **`storage.js`**: **数据持久化层**。统一封装 `localStorage` (本地) 和 `LeanCloud` (云端) 的读写操作，负责处理复杂的数据同步、合并与冲突解决逻辑。
*   **`utils.js`**: **工具函数库**。包含日期格式化、ID 生成、防抖节流等通用纯函数。
*   **`constants.js`**: **静态配置中心**。集中管理游戏文案、商品列表、每日情话、等级规则等静态数据，方便运营维护。
*   **`sound-manager.js`**: **音效引擎**。基于 Web Audio API 的独立模块，支持多种音效风格（清脆、击鼓、电子等）切换。

### 2. UI 模块 (`js/ui/`)
*   **`ui-manager.js`**: **视觉表现层**。负责全局通用的 UI 组件，如 Toast 提示、弹窗管理、樱花飘落特效、动态桌面图标生成等。

### 3. 业务逻辑层
*   **`common.js`**: **业务控制器 (Controller)**。作为胶水层，负责组装 Core 和 UI 模块，处理用户交互事件（如签到、购买、积分变更），不再包含底层实现细节。
*   **页面脚本**: 各个 HTML 页面（如 `index.html`, `games.html`）仅包含少量的初始化代码和特定页面的交互逻辑。

### 4. 视图层 (View)
*   **HTML/CSS**: 采用标准的 HTML5 和 CSS3 (Variables) 构建，`common.css` 提供全局样式系统，`themes.css` 支持多套主题切换。

### 5. 目录结构
```text
root/
  ├─ js/
  │  ├─ core/           # 核心逻辑模块
  │  │  ├─ constants.js # 静态配置
  │  │  ├─ sound-manager.js # 音效管理
  │  │  ├─ storage.js   # 数据存储与同步
  │  │  └─ utils.js     # 工具函数
  │  ├─ ui/             # UI 模块
  │  │  └─ ui-manager.js # UI 管理器
  │  ├─ game2048.js     # 2048 游戏逻辑
  │  ├─ match3.js       # 消消乐游戏逻辑
  │  └─ sudoku.js       # 数独游戏逻辑
  ├─ common.js          # 全局业务控制器
  ├─ common.css         # 全局样式
  └─ *.html             # 各个功能页面
```

---

## 📁 项目结构

本项目已拆分为多个HTML页面，便于在GitHub Pages上部署和访问：

- **`index.html`** - 主页面（积分系统、每日签到、加减分功能）
- **`wishlist.html`** - 愿望清单页面（记录和完成恋爱愿望）
- **`album.html`** - 温馨相册页面（拍立得风格照片管理）
- **`shop.html`** - 恋爱商店页面（兑换中心和背包系统）
- **`games.html`** - 游戏中心页面（消消乐、2048等小游戏）
- **`settings.html`** - 设置页面（生理期记录、云同步配置、历史记录）

### 公共资源文件

- **`common.css`** - 所有页面共享的样式文件
- **`common.js`** - 所有页面共享的JavaScript逻辑（包含数据管理、SoundManager音效系统）
- **`themes.css`** - 主题样式文件（支持多套主题切换）

### 游戏文件

- **`js/match3.js`** - 甜蜜消消乐游戏逻辑（V4.0 连击道具版）
- **`js/game2048.js`** - 2048数字合成游戏逻辑（V4.2 模块化版）
- **`js/sudoku.js`** - 数独游戏逻辑（V1.6 理论极限优化版）
- **`games.html`** - 游戏中心页面（消消乐、2048、数独等小游戏）

## ✨ 主要功能

### V4.6 数独理论极限优化 🔬 (Latest)
1. **理论下限修正**：
   * 修正了极限难度的目标提示数，从 20 个调整为 **17 个**（数独唯一解的理论下限）
   * 内置了经过验证的 17 提示数独题目库，修复了之前版本中存在的无效占位题目问题
   * 添加了 `generateExtremePuzzleBatch` 工具函数，方便后续扩充高难度题目库
   * 添加了性能保护机制，避免生成题目时无限循环
   * 更新了代码注释，明确说明 17 个提示数是经过数学证明的理论极限

### V4.5 数独 UI 极致优化 📱
1.  **紧凑布局**：
    *   重新设计了数独的操作面板，将数字键盘调整为 **5列 x 2行** 的紧凑布局，所有按钮（包括擦除）大小统一，视觉更整洁。
    *   将功能按钮（笔记、自动、清空、重开）和辅助按钮（查看答案、难度切换）整合为两行紧凑工具栏，大幅节省了垂直空间，防止在小屏手机上需要频繁滚动。
2.  **视觉微调**：
    *   加深了相同数字的**高亮颜色**，并增加了**字体加粗**效果，让关联数字一目了然。
    *   优化了按钮样式，功能分区更清晰。

### V4.4 数独答案与积分联动 💡
1.  **查看答案功能**：
    *   **💡 单格答案**：查看选中格子的答案，消耗 **1 积分/甜度**。
    *   **🚀 全解 (终极作弊)**：直接填满所有正确答案，消耗 **10 积分/甜度**。
    *   **积分交易机制**：女生查看扣甜度转积分给男生，男生查看扣积分转甜度给女生。
2.  **奖励提升**：每日首次获胜奖励提升至 **20 积分/甜度**。

### V3.x 系列更新
(略，详见历史记录)

## 📱 如何安装到手机？

### 方法一：添加到主屏幕（最推荐，永久免费）🌟
这种方法不需要复杂的打包，不需要证书，体验和原生 App 几乎一样（全屏运行，无地址栏）。

1.  将所有HTML文件和公共资源文件上传到静态网站托管（GitHub Pages 等）。
2.  在手机浏览器中打开链接。
3.  点击 **分享按钮** -> **“添加到主屏幕”**。

## 🚀 GitHub Pages 部署

1. 将所有文件推送到GitHub仓库
2. 在仓库设置中启用GitHub Pages
3. 选择主分支（通常是`main`或`master`）作为源
4. 访问 `https://你的用户名.github.io/仓库名/`

## ⚠️ 注意事项
*   本项目使用了 LeanCloud 进行数据存储，请确保在设置页面中正确配置了你的 AppID 和 AppKey。

---
*Made with ❤️ for Love.*

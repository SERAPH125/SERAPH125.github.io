# 男朋友养成计划 V3.6 Cloud ❤️

这是一个专为情侣设计的互动网页应用，包含甜蜜积分、愿望清单、恋爱商店、**温馨相册**、**姨妈助手**、**年度计划**等功能，并支持云端数据同步。

## 🏗️ 软件架构说明 (Software Architecture)

本项目采用 **MPA (多页应用)** 架构，经过 V4.x 版本的模块化重构，实现了核心逻辑与 UI 的解耦，提高了代码的可维护性和扩展性。

### 1. 核心模块 (`js/core/`)
*   **`storage.js`**: **数据持久化层**。统一封装 `localStorage` (本地) 和 `LeanCloud` (云端) 的读写操作，负责处理复杂的数据同步、合并与冲突解决逻辑。
*   **`utils.js`**: **工具函数库**。包含日期格式化、ID 生成、防抖节流等通用纯函数。
*   **`constants.js`**: **静态配置中心**。集中管理游戏文案、商品列表、每日情话、等级规则等静态数据，方便运营维护。
*   **`sound-manager.js`**: **音效引擎**。基于 Web Audio API 的独立模块，支持多种音效风格（清脆、击鼓、电子等）切换。

### 2. UI 模块 (`js/ui/`)
*   **`ui-manager.js`**: **视觉表现层**。负责全局通用的 UI 组件，如 Toast 提示、弹窗管理、樱花飘落特效、动态桌面图标生成等。

### 3. 业务逻辑层
*   **`common.js`**: **业务控制器 (Controller)**。作为胶水层，负责组装 Core 和 UI 模块，处理用户交互事件（如签到、购买、积分变更），不再包含底层实现细节。
*   **页面脚本**: 各个 HTML 页面（如 `index.html`, `games.html`）仅包含少量的初始化代码和特定页面的交互逻辑。

### 4. 视图层 (View)
*   **HTML/CSS**: 采用标准的 HTML5 和 CSS3 (Variables) 构建，`common.css` 提供全局样式系统，`themes.css` 支持多套主题切换。

### 5. 目录结构
```text
root/
  ├─ js/
  │  ├─ core/           # 核心逻辑模块
  │  │  ├─ constants.js # 静态配置
  │  │  ├─ sound-manager.js # 音效管理
  │  │  ├─ storage.js   # 数据存储与同步
  │  │  └─ utils.js     # 工具函数
  │  ├─ ui/             # UI 模块
  │  │  └─ ui-manager.js # UI 管理器
  │  ├─ game2048.js     # 2048 游戏逻辑
  │  ├─ match3.js       # 消消乐游戏逻辑
  │  └─ sudoku.js       # 数独游戏逻辑
  ├─ common.js          # 全局业务控制器
  ├─ common.css         # 全局样式
  └─ *.html             # 各个功能页面
```

---

## 📁 项目结构

本项目已拆分为多个HTML页面，便于在GitHub Pages上部署和访问：

- **`index.html`** - 主页面（积分系统、每日签到、加减分功能）
- **`wishlist.html`** - 愿望清单页面（记录和完成恋爱愿望）
- **`album.html`** - 温馨相册页面（拍立得风格照片管理）
- **`shop.html`** - 恋爱商店页面（兑换中心和背包系统）
- **`games.html`** - 游戏中心页面（消消乐、2048等小游戏）
- **`plan.html`** - 年度计划页面（分类管理、阶段性任务、内容记录）
- **`settings.html`** - 设置页面（生理期记录、云同步配置、历史记录）

### 公共资源文件

- **`common.css`** - 所有页面共享的样式文件
- **`common.js`** - 所有页面共享的JavaScript逻辑（包含数据管理、SoundManager音效系统）
- **`themes.css`** - 主题样式文件（支持多套主题切换）

### 游戏文件

- **`js/match3.js`** - 甜蜜消消乐游戏逻辑（V4.0 连击道具版）
- **`js/game2048.js`** - 2048数字合成游戏逻辑（V4.2 模块化版）
- **`js/sudoku.js`** - 数独游戏逻辑（V1.7 数独题库验证版）
- **`games.html`** - 游戏中心页面（消消乐、2048、数独等小游戏）

## ✨ 主要功能

### V4.14 桥本饮食指南模块上线 🥗
1.  **专属饮食数据库**：
    *   **红绿灯分类**：内置针对桥本氏甲状腺炎的食物红黑榜（绿灯推荐、黄灯少吃、红灯忌口），涵盖谷物、蔬菜、肉类等 14 大类。
    *   **智能搜索**：支持输入食物名称或关键词（如“面条”、“麸质”）快速查询饮食建议。
    *   **详细解读**：点击食物图标即可查看详细的推荐/忌口原因（如“含麸质易诱发炎症”），帮助用户知其然更知其所以然。
2.  **打卡与统计**：
    *   保留原有的每日饮食打卡功能，记录早中晚及服药情况，自动统计连续坚持天数。

### V3.7 年度计划系统 📋 (UI 重构)
1.  **视觉体验升级**：
    *   **环形进度仪表盘**：采用动态环形进度条展示年度总进度，视觉效果更直观震撼。
    *   **交互动画**：完成计划时触发烟花/花瓣庆祝特效，增加成就感。
    *   **现代化 UI**：全新的卡片式设计，更柔和的阴影和色彩，适配 iOS 设计语言。
2.  **功能优化**：
    *   **分类管理**：支持7大分类（读书清单、电影清单、休闲娱乐、身体健康、日常生活、体验突破、自我提升），通过标签页切换查看。
    *   **阶段性任务**：支持单次任务和阶段性任务（如"看20部电影"），支持记录具体内容。

### V4.13 历史记录归类优化 🔧
1.  **签到与游戏记录归类**：
    *   **日常化管理**：将“每日签到”和“游戏挑战成功”产生的记录统一移动到了 **“日常与消费”** 标签页下，防止刷屏。
    *   **专注甜蜜**：现在 **“甜蜜瞬间”** 标签页只专注于显示手动记录的心动时刻和完成随机任务的奖励。

### V4.12 姨妈助手智能化与设置页重构 🔧
1.  **姨妈助手功能升级**：
    *   **智能阶段推算**：不再仅仅显示倒计时，现在会根据生理周期自动推算出当前处于**月经期、卵泡期、排卵期**还是**黄体期**。
    *   **贴心建议**：针对不同阶段提供相应的暖心建议（如“多喝热水”、“适宜约会”、“情绪波动提醒”等）。
    *   **个性化设置**：支持自定义**平均周期**（默认28天）和**经期持续时间**（默认5天），计算更准确。
2.  **设置页面重构**：
    *   **折叠式布局**：将身份切换、主题风格、云同步等模块改为手风琴折叠样式，解决了页面过长的问题，界面更清爽。
    *   **体验优化**：生理期设置作为最高频功能默认展开，其他低频设置默认折叠。

### V4.11 相册体验修复 🔧
1.  **移动端布局优化**：
    *   **解决照片溢出**：修复了在小屏幕设备上，因拍立得旋转效果导致的相片溢出屏幕边界的问题。现在针对小屏设备减小了旋转角度并优化了间距。
    *   **统一照片尺寸**：修复了部分设备上 CSS `aspect-ratio` 兼容性不佳导致的照片大小不一问题。采用 `padding-bottom` 方案强制所有照片框保持严格的 1:1 正方形比例。

### V4.10 女生签到甜度保存修复 🔧
1.  **云端数据合并修复**：
    *   **甜度覆盖问题解决**：修复了云端数据同步时，女生签到后甜度被云端旧数据覆盖的问题。现在在 `handleCloudMerge` 方法中，会分别检测男生和女生的签到状态，并优先使用本地刚刚签到后的积分/甜度数据，确保签到奖励不会丢失。
    *   修复了"女生签到不加甜度积分"的严重 BUG，现在女生签到后甜度会正确保存并同步到云端。

### V4.9 签到与奖励系统底层修复 🔧
1.  **日期计算逻辑修复**：
    *   **时区问题解决**：修复了签到系统中计算连续天数时，因 `Date` 对象解析 UTC 时间导致的时区偏差。现在统一使用本地时间 `00:00:00` 进行比较，彻底解决了“明明是第二天签到却被判为断签”或“同一天内被判为签到多次”的 BUG。
    *   **跨日判定优化**：优化了日期差计算公式，使用 `Math.round` 替代 `Math.ceil`，避免微小的时间戳误差导致天数计算错误。
2.  **游戏奖励判定修复**：
    *   **Key值一致性**：修复了游戏中心在判断“今日是否已领奖”时，生成的 `localStorage` Key 日期格式可能与当前系统时间不一致的问题。现在统一调用 `utils.getTodayStr()`，确保 Key 值的唯一性和准确性。
    *   解决了“明明当天没玩过游戏（或玩了没领奖），系统却提示已领奖”的严重 BUG。

### V4.8 签到系统逻辑重构 🛠️
1.  **修复积分/甜度混淆 BUG**：
    *   修复了女生签到时错误地增加“积分 (Boy)”而非“甜度 (Girl)”的问题。现在女生签到将正确获得甜度奖励。
2.  **奖励机制优化**：
    *   **奖励叠加**：修复了“连击奖励”与“双人签到奖励”互斥的问题。现在如果某天既是连击日又是双人签到，奖励将**叠加计算**（基础奖励 + 连击奖励 + 双人加成），确保用户利益最大化。
    *   **连击大奖**：连续签到每满 7 天，基础奖励提升至 20 分/甜度。
    *   **双人加成**：双人同天签到额外 +5 分/甜度。
3.  **UI 细节优化**：
    *   签到弹窗现在会根据用户角色动态显示正确的单位（💎 积分 / 🍬 甜度）。

### V4.7 数独题库验证与体验优化 🔍
(略)

### V4.6 数独理论极限优化 🔬
(略)

### V4.5 数独 UI 极致优化 📱
(略)

### V4.4 数独答案与积分联动 💡
(略)

### V3.x 系列更新
(略，详见历史记录)

## 📱 如何安装到手机？

### 方法一：添加到主屏幕（最推荐，永久免费）🌟
这种方法不需要复杂的打包，不需要证书，体验和原生 App 几乎一样（全屏运行，无地址栏）。

1.  将所有HTML文件和公共资源文件上传到静态网站托管（GitHub Pages 等）。
2.  在手机浏览器中打开链接。
3.  点击 **分享按钮** -> **“添加到主屏幕”**。

## 🚀 GitHub Pages 部署

1. 将所有文件推送到GitHub仓库
2. 在仓库设置中启用GitHub Pages
3. 选择主分支（通常是`main`或`master`）作为源
4. 访问 `https://你的用户名.github.io/仓库名/`

## ⚠️ 注意事项
*   本项目使用了 LeanCloud 进行数据存储，请确保在设置页面中正确配置了你的 AppID 和 AppKey。

---
*Made with ❤️ for Love.*

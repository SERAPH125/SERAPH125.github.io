<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="å‘¨é‡‘éœç”·å‹">
    <title>å¹´åº¦è®¡åˆ’ - å°å‘¨çš„ç”·å‹å…»æˆè®¡åˆ’ â¤ï¸</title>
    <script src="https://cdn.jsdelivr.net/npm/leancloud-storage@4.15.0/dist/av-min.js"></script>
    <link rel="stylesheet" href="common.css">
    <style>
        /* å¹´åº¦è®¡åˆ’ç‰¹å®šæ ·å¼ */
        .plan-category {
            margin-bottom: 25px;
        }
        .category-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 15px;
            padding: 12px 15px;
            background: rgba(255,255,255,0.5);
            border-radius: 15px;
            border-left: 4px solid var(--accent-pink);
        }
        .category-title {
            font-size: 1.1rem;
            font-weight: bold;
            color: var(--text-main);
        }
        .category-progress {
            font-size: 0.85rem;
            color: var(--text-light);
        }
        .plan-item {
            background: rgba(255,255,255,0.7);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 12px;
            transition: all 0.3s;
            border: 1px solid rgba(255,255,255,0.5);
            position: relative;
        }
        .plan-item.completed {
            background: rgba(255,255,255,0.4);
            opacity: 0.7;
        }
        .plan-item-content {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            width: 100%;
            min-height: 32px;
        }
        .plan-checkbox {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            border: 2px solid var(--accent-pink);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s;
            flex-shrink: 0;
            background: white;
            margin-top: 2px;
        }
        .plan-checkbox.checked {
            background: var(--accent-pink);
            border-color: var(--accent-pink);
        }
        .plan-checkbox::after {
            content: 'âœ“';
            color: white;
            font-size: 14px;
            display: none;
        }
        .plan-checkbox.checked::after {
            display: block;
        }
        .plan-name {
            font-weight: 500;
            color: var(--text-main);
            flex: 1;
            line-height: 1.5;
            word-break: break-word;
            font-size: 0.95rem;
        }
        .plan-item.completed .plan-name {
            text-decoration: line-through;
            color: var(--text-light);
        }
        .plan-actions {
            display: flex;
            align-items: center;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 12px;
            padding-left: 36px;
        }
        .plan-progress {
            font-size: 0.85rem;
            color: var(--accent-pink);
            font-weight: bold;
            white-space: nowrap;
        }
        .plan-progress-bar {
            width: 100px;
            height: 6px;
            background: rgba(255,154,158,0.2);
            border-radius: 3px;
            overflow: hidden;
            flex-shrink: 0;
        }
        .plan-progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #ff9a9e, #fecfef);
            border-radius: 3px;
            transition: width 0.3s;
        }
        .btn-add-progress {
            background: linear-gradient(135deg, #a18cd1, #fbc2eb);
            color: white;
            border: none;
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.2s;
            white-space: nowrap;
        }
        .btn-add-progress:active {
            transform: scale(0.95);
        }
        .plan-item.completed .btn-add-progress {
            display: none;
        }
        .overall-progress {
            background: linear-gradient(135deg, #a18cd1, #fbc2eb);
            color: white;
            padding: 20px;
            border-radius: 20px;
            margin-bottom: 25px;
            text-align: center;
            box-shadow: var(--shadow);
        }
        .overall-progress-title {
            font-size: 1rem;
            margin-bottom: 10px;
            opacity: 0.9;
        }
        .overall-progress-value {
            font-size: 2.5rem;
            font-weight: bold;
            margin: 10px 0;
            font-family: 'Georgia', serif;
        }
        .overall-progress-bar {
            background: rgba(255,255,255,0.3);
            height: 10px;
            border-radius: 10px;
            overflow: hidden;
            margin-top: 15px;
        }
        .overall-progress-fill {
            height: 100%;
            background: white;
            border-radius: 10px;
            transition: width 0.5s;
        }
        /* åˆ†ç±»æ ‡ç­¾ */
        .plan-category-tabs {
            display: flex;
            gap: 8px;
            overflow-x: auto;
            margin-bottom: 20px;
            padding-bottom: 5px;
            -webkit-overflow-scrolling: touch;
        }
        .plan-category-tabs::-webkit-scrollbar {
            height: 4px;
        }
        .plan-category-tab {
            padding: 10px 16px;
            background: rgba(255,255,255,0.5);
            border: 1px solid rgba(255,255,255,0.5);
            border-radius: 20px;
            font-size: 0.9rem;
            white-space: nowrap;
            cursor: pointer;
            transition: all 0.3s;
            flex-shrink: 0;
        }
        .plan-category-tab.active {
            background: white;
            color: var(--accent-pink);
            border-color: var(--accent-pink);
            font-weight: bold;
            box-shadow: 0 4px 10px rgba(0,0,0,0.05);
        }
        .plan-category-tab:hover {
            background: rgba(255,255,255,0.7);
        }
        /* æ·»åŠ è®¡åˆ’æŒ‰é’® */
        .btn-add-plan {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, #a18cd1, #fbc2eb);
            color: white;
            border: none;
            border-radius: 50%;
            font-size: 2rem;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(161, 140, 209, 0.4);
            transition: transform 0.2s;
            z-index: 100;
        }
        .btn-add-plan:active {
            transform: scale(0.9);
        }
        /* åˆ é™¤æŒ‰é’® */
        .btn-delete-plan {
            background: none;
            border: none;
            color: var(--text-light);
            font-size: 1.1rem;
            cursor: pointer;
            padding: 4px;
            opacity: 0.5;
            transition: all 0.2s;
            flex-shrink: 0;
            width: 28px;
            height: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            margin-left: auto;
        }
        .plan-item:hover .btn-delete-plan {
            opacity: 1;
            background: rgba(255,154,158,0.1);
        }
        .btn-delete-plan:hover {
            color: var(--danger);
            background: rgba(255,154,158,0.2);
            transform: scale(1.1);
        }
        .btn-delete-plan:active {
            transform: scale(0.95);
        }
    </style>
</head>
<body>
<div class="bg-shape shape-1"></div>
<div class="bg-shape shape-2"></div>
<div id="sakura-container"></div>

<div class="container">
    <header>
        <h1>ğŸ“‹ å°å‘¨çš„å¹´åº¦è®¡åˆ’ <span class="version-tag">V3.6</span></h1>
        <div class="love-days">2025å¹´åº¦ç›®æ ‡ ğŸ’•</div>
    </header>

    <div class="nav-tabs">
        <a href="index.html" class="nav-btn">ğŸ  ä¸»é¡µ</a>
        <a href="wishlist.html" class="nav-btn">âœ¨ æ„¿æœ›</a>
        <a href="album.html" class="nav-btn">ğŸ–¼ï¸ ç›¸å†Œ</a>
        <a href="shop.html" class="nav-btn">ğŸ å•†åº—</a>
        <a href="games.html" class="nav-btn">ğŸ® æ¸¸æˆ</a>
        <a href="plan.html" class="nav-btn active">ğŸ“‹ è®¡åˆ’</a>
        <a href="settings.html" class="nav-btn">âš™ï¸ è®¾ç½®</a>
    </div>

    <!-- æ€»ä½“è¿›åº¦ -->
    <div class="overall-progress">
        <div class="overall-progress-title">å¹´åº¦è®¡åˆ’å®Œæˆåº¦</div>
        <div class="overall-progress-value" id="overall-progress-value">0%</div>
        <div class="overall-progress-bar">
            <div class="overall-progress-fill" id="overall-progress-fill" style="width: 0%"></div>
        </div>
    </div>

    <!-- åˆ†ç±»æ ‡ç­¾ -->
    <div class="plan-category-tabs" id="category-tabs"></div>

    <!-- è®¡åˆ’åˆ—è¡¨ -->
    <div id="plan-list"></div>
</div>

<!-- æ·»åŠ è®¡åˆ’æŒ‰é’® -->
<button class="btn-add-plan" onclick="app.showAddPlanModal()" title="æ·»åŠ æ–°è®¡åˆ’">â•</button>

<!-- æ–°å¢è®¡åˆ’å¼¹çª— -->
<div class="modal-overlay" id="add-plan-modal" style="display:none;">
    <div class="modal" style="width:85%; max-width:350px;">
        <span style="font-size:3rem; display:block; margin-bottom:15px;">â•</span>
        <h3 style="margin:0 0 15px 0;">æ·»åŠ æ–°è®¡åˆ’</h3>
        <input type="text" id="plan-name-input" placeholder="è®¡åˆ’åç§°" style="margin-bottom:10px;">
        <select id="plan-category-select" style="width:100%; padding:15px; border:2px solid transparent; background:rgba(255,255,255,0.6); border-radius:18px; font-size:1rem; margin-bottom:10px; outline:none;">
            <option value="è¯»ä¹¦æ¸…å•ğŸ“–">è¯»ä¹¦æ¸…å•ğŸ“–</option>
            <option value="ç”µå½±æ¸…å•ğŸ¬">ç”µå½±æ¸…å•ğŸ¬</option>
            <option value="ä¼‘é—²å¨±ä¹">ä¼‘é—²å¨±ä¹</option>
            <option value="èº«ä½“å¥åº·">èº«ä½“å¥åº·</option>
            <option value="æ—¥å¸¸ç”Ÿæ´»">æ—¥å¸¸ç”Ÿæ´»</option>
            <option value="ä½“éªŒçªç ´">ä½“éªŒçªç ´</option>
            <option value="è‡ªæˆ‘æå‡">è‡ªæˆ‘æå‡</option>
        </select>
        <input type="number" id="plan-target-input" placeholder="ç›®æ ‡æ•°é‡ï¼ˆ1è¡¨ç¤ºå•æ¬¡ä»»åŠ¡ï¼‰" min="1" value="1" style="margin-bottom:10px;">
        <input type="text" id="plan-icon-input" placeholder="å›¾æ ‡ï¼ˆå¦‚ï¼šğŸ“–ï¼‰" maxlength="2" style="margin-bottom:15px;">
        <div style="display:flex; gap:10px;">
            <button onclick="document.getElementById('add-plan-modal').style.display='none'" style="flex:1; background:#f0f0f0; border:none; padding:12px; border-radius:12px;">å–æ¶ˆ</button>
            <button onclick="app.addNewPlan()" style="flex:1; background:linear-gradient(135deg, #a18cd1, #fbc2eb); color:white; border:none; padding:12px; border-radius:12px; font-weight:bold;">æ·»åŠ </button>
        </div>
    </div>
</div>

<script src="js/core/sound-manager.js"></script>
<script src="js/core/storage.js"></script>
<script src="js/core/utils.js"></script>
<script src="js/core/constants.js"></script>
<script src="js/ui/ui-manager.js"></script>
<script src="common.js"></script>
<script>
// å¹´åº¦è®¡åˆ’åˆå§‹æ•°æ®
const annualPlanTemplate = [
    // ä¸€ã€è¯»ä¹¦æ¸…å•ğŸ“–ï¼ˆ15æœ¬ï¼‰
    { category: 'è¯»ä¹¦æ¸…å•ğŸ“–', name: 'ã€Šæ´»ç€ã€‹', target: 1, current: 0, completed: false, icon: 'ğŸ“–' },
    { category: 'è¯»ä¹¦æ¸…å•ğŸ“–', name: 'ã€Šå…„å¼Ÿã€‹', target: 1, current: 0, completed: false, icon: 'ğŸ“–' },
    { category: 'è¯»ä¹¦æ¸…å•ğŸ“–', name: 'ã€Šè¢«è®¨åŒçš„å‹‡æ°”ã€‹', target: 1, current: 0, completed: false, icon: 'ğŸ“–' },
    { category: 'è¯»ä¹¦æ¸…å•ğŸ“–', name: 'ã€Šè¥¿è¥¿å¼—ç¥è¯ã€‹', target: 1, current: 0, completed: false, icon: 'ğŸ“–' },
    { category: 'è¯»ä¹¦æ¸…å•ğŸ“–', name: 'ã€Šç“¦å°”ç™»æ¹–ã€‹', target: 1, current: 0, completed: false, icon: 'ğŸ“–' },
    { category: 'è¯»ä¹¦æ¸…å•ğŸ“–', name: 'ã€Šç™¾å¹´å­¤ç‹¬ã€‹', target: 1, current: 0, completed: false, icon: 'ğŸ“–' },
    { category: 'è¯»ä¹¦æ¸…å•ğŸ“–', name: 'ã€Šå›´åŸã€‹', target: 1, current: 0, completed: false, icon: 'ğŸ“–' },
    { category: 'è¯»ä¹¦æ¸…å•ğŸ“–', name: 'ã€Šæˆ‘ä¸åœ°å›ã€‹', target: 1, current: 0, completed: false, icon: 'ğŸ“–' },
    { category: 'è¯»ä¹¦æ¸…å•ğŸ“–', name: 'ã€Šæ–‡åŒ–è‹¦æ—…ã€‹', target: 1, current: 0, completed: false, icon: 'ğŸ“–' },
    { category: 'è¯»ä¹¦æ¸…å•ğŸ“–', name: 'ã€Šæ‚‰è¾¾å¤šã€‹', target: 1, current: 0, completed: false, icon: 'ğŸ“–' },
    { category: 'è¯»ä¹¦æ¸…å•ğŸ“–', name: 'ã€Šç‰›è™»ã€‹', target: 1, current: 0, completed: false, icon: 'ğŸ“–' },
    { category: 'è¯»ä¹¦æ¸…å•ğŸ“–', name: 'ã€Šç›¸çº¦æ˜ŸæœŸäºŒã€‹', target: 1, current: 0, completed: false, icon: 'ğŸ“–' },
    { category: 'è¯»ä¹¦æ¸…å•ğŸ“–', name: 'ã€Šè€å®äººå¯è’™ã€‹', target: 1, current: 0, completed: false, icon: 'ğŸ“–' },
    
    // äºŒã€ç”µå½±æ¸…å•ğŸ¬ï¼ˆ20éƒ¨ï¼‰
    { category: 'ç”µå½±æ¸…å•ğŸ¬', name: 'çœ‹ç”µå½±', target: 20, current: 0, completed: false, icon: 'ğŸ¬' },
    
    // ä¸‰ã€ä¼‘é—²å¨±ä¹
    { category: 'ä¼‘é—²å¨±ä¹', name: 'çœ‹ä¸€æ¬¡æ—¥å‡ºğŸŒ…', target: 1, current: 0, completed: false, icon: 'ğŸŒ…' },
    { category: 'ä¼‘é—²å¨±ä¹', name: 'çœ‹ä¸€æ¬¡æ—¥è½ğŸŒ„', target: 1, current: 0, completed: false, icon: 'ğŸŒ„' },
    { category: 'ä¼‘é—²å¨±ä¹', name: 'çœ‹ä¸€åœºçƒŸèŠ±ğŸ†', target: 1, current: 0, completed: false, icon: 'ğŸ†' },
    { category: 'ä¼‘é—²å¨±ä¹', name: 'æ»‘é›ª', target: 1, current: 0, completed: false, icon: 'â›·ï¸' },
    { category: 'ä¼‘é—²å¨±ä¹', name: 'å¡ä¸è½¦', target: 1, current: 0, completed: false, icon: 'ğŸï¸' },
    { category: 'ä¼‘é—²å¨±ä¹', name: 'å°„ç®­', target: 1, current: 0, completed: false, icon: 'ğŸ¹' },
    { category: 'ä¼‘é—²å¨±ä¹', name: 'æ”€å²©', target: 1, current: 0, completed: false, icon: 'ğŸ§—' },
    { category: 'ä¼‘é—²å¨±ä¹', name: 'å±±é—´æ°‘å®¿ä½“éªŒ', target: 1, current: 0, completed: false, icon: 'ğŸ¡' },
    { category: 'ä¼‘é—²å¨±ä¹', name: 'æ”¾é£ç­ğŸª', target: 1, current: 0, completed: false, icon: 'ğŸª' },
    { category: 'ä¼‘é—²å¨±ä¹', name: 'æŒ‰æ‘©ğŸ’†â€â™€ï¸', target: 1, current: 0, completed: false, icon: 'ğŸ’†â€â™€ï¸' },
    
    // å››ã€èº«ä½“å¥åº·
    { category: 'èº«ä½“å¥åº·', name: 'ç˜¦åˆ°105æ–¤', target: 1, current: 0, completed: false, icon: 'âš–ï¸' },
    { category: 'èº«ä½“å¥åº·', name: 'éª‘è½¦20æ¬¡ğŸš´', target: 20, current: 0, completed: false, icon: 'ğŸš´' },
    { category: 'èº«ä½“å¥åº·', name: 'ä¸€å‘¨æ— éº¸è´¨é¥®é£Ÿ', target: 1, current: 0, completed: false, icon: 'ğŸ¥—' },
    { category: 'èº«ä½“å¥åº·', name: 'æŒ‘æˆ˜ä¸€ä¸ªæœˆä¸å–å¥¶èŒ¶ğŸ¥¤', target: 1, current: 0, completed: false, icon: 'ğŸ¥¤' },
    { category: 'èº«ä½“å¥åº·', name: 'æŒ‘æˆ˜ä¸€ä¸ªæœˆä¸åƒç”œå“ğŸ®', target: 1, current: 0, completed: false, icon: 'ğŸ®' },
    { category: 'èº«ä½“å¥åº·', name: 'ç§ç‰™ğŸ¦·', target: 1, current: 0, completed: false, icon: 'ğŸ¦·' },
    { category: 'èº«ä½“å¥åº·', name: 'ä¹ä»·ğŸ’‰', target: 1, current: 0, completed: false, icon: 'ğŸ’‰' },
    
    // äº”ã€æ—¥å¸¸ç”Ÿæ´»
    { category: 'æ—¥å¸¸ç”Ÿæ´»', name: 'å¹³å¸¸çš„æ—¥å­é‡Œæ—©èµ·ä¸€å‘¨', target: 1, current: 0, completed: false, icon: 'ğŸŒ…' },
    { category: 'æ—¥å¸¸ç”Ÿæ´»', name: 'æ‹ä¸ªå†™çœŸ', target: 1, current: 0, completed: false, icon: 'ğŸ“¸' },
    { category: 'æ—¥å¸¸ç”Ÿæ´»', name: 'å»ä¸€ä¸ªæ–°åŸå¸‚æ—…æ¸¸', target: 1, current: 0, completed: false, icon: 'âœˆï¸' },
    { category: 'æ—¥å¸¸ç”Ÿæ´»', name: 'è¿œè·ç¦»æ—…æ¸¸ä¸€æ¬¡', target: 1, current: 0, completed: false, icon: 'ğŸŒ' },
    { category: 'æ—¥å¸¸ç”Ÿæ´»', name: 'çˆ¬3åº§å±±', target: 3, current: 0, completed: false, icon: 'â›°ï¸' },
    { category: 'æ—¥å¸¸ç”Ÿæ´»', name: 'çœ‹ä¸€æ¬¡æµ·', target: 1, current: 0, completed: false, icon: 'ğŸŒŠ' },
    { category: 'æ—¥å¸¸ç”Ÿæ´»', name: 'å­¦ä¼šæ¸¸æ³³', target: 1, current: 0, completed: false, icon: 'ğŸŠ' },
    { category: 'æ—¥å¸¸ç”Ÿæ´»', name: 'æ¯æœˆä¹°ä¸€æŸèŠ±', target: 12, current: 0, completed: false, icon: 'ğŸŒ¸' },
    { category: 'æ—¥å¸¸ç”Ÿæ´»', name: 'æ—©èµ·å»æ—©å¸‚æ„Ÿå—çƒŸç«æ°”', target: 1, current: 0, completed: false, icon: 'ğŸŒ†' },
    { category: 'æ—¥å¸¸ç”Ÿæ´»', name: 'æŒ‘æˆ˜ä¸€ä¸ªæœˆä¸ç½‘è´­', target: 1, current: 0, completed: false, icon: 'ğŸ›’' },
    
    // å…­ã€ä½“éªŒçªç ´
    { category: 'ä½“éªŒçªç ´', name: 'æ‰¾ä¸€ç™¾ä½é™Œç”Ÿäººè¯´è¯ğŸ—£ï¸', target: 100, current: 0, completed: false, icon: 'ğŸ—£ï¸' },
    { category: 'ä½“éªŒçªç ´', name: 'çœ‹ä¸€æ¬¡è¯å‰§', target: 1, current: 0, completed: false, icon: 'ğŸ­' },
    { category: 'ä½“éªŒçªç ´', name: 'éšæœºå…¬äº¤ä¸‹ç«™æ„Ÿå—ç”Ÿæ´»', target: 1, current: 0, completed: false, icon: 'ğŸšŒ' },
    { category: 'ä½“éªŒçªç ´', name: 'è¶…é•¿è·ç¦»éª‘è¡Œ', target: 1, current: 0, completed: false, icon: 'ğŸš´' },
    { category: 'ä½“éªŒçªç ´', name: 'æˆ·å¤–éœ²è¥ğŸ•ï¸', target: 1, current: 0, completed: false, icon: 'ğŸ•ï¸' },
    { category: 'ä½“éªŒçªç ´', name: 'å®Œæˆåå…¬é‡Œä»¥ä¸Šçš„å¾’æ­¥', target: 1, current: 0, completed: false, icon: 'ğŸ¥¾' },
    { category: 'ä½“éªŒçªç ´', name: 'æœ¬äººå¼€è½¦è‡ªé©¾æ¸¸', target: 1, current: 0, completed: false, icon: 'ğŸš—' },
    { category: 'ä½“éªŒçªç ´', name: 'ä¸€ä¸ªäººè‡ªç”±è¡Œ', target: 1, current: 0, completed: false, icon: 'ğŸ’' },
    { category: 'ä½“éªŒçªç ´', name: 'å»é…’å§', target: 1, current: 0, completed: false, icon: 'ğŸ·' },
    { category: 'ä½“éªŒçªç ´', name: 'å­¦ä¸€æ”¯ç®€å•çš„èˆè¹ˆğŸ’ƒ', target: 1, current: 0, completed: false, icon: 'ğŸ’ƒ' },
    { category: 'ä½“éªŒçªç ´', name: 'æ‹¿ç€ç›¸æœºå»æ‰«è¡—', target: 1, current: 0, completed: false, icon: 'ğŸ“·' },
    { category: 'ä½“éªŒçªç ´', name: 'æŒ‘æˆ˜ä¸€å‘¨åªèŠ±80', target: 1, current: 0, completed: false, icon: 'ğŸ’°' },
    { category: 'ä½“éªŒçªç ´', name: 'ç»™äº”å¹´åçš„è‡ªå·±å†™ä¸€å°ä¿¡', target: 1, current: 0, completed: false, icon: 'âœ‰ï¸' },
    
    // ä¸ƒã€è‡ªæˆ‘æå‡
    { category: 'è‡ªæˆ‘æå‡', name: 'æ¯æœˆå†™ä¸€ç¯‡åæ€æ€»ç»“', target: 12, current: 0, completed: false, icon: 'âœï¸' },
    { category: 'è‡ªæˆ‘æå‡', name: 'å»å›¾ä¹¦é¦†çœ‹ä¸€å¤©ä¹¦', target: 1, current: 0, completed: false, icon: 'ğŸ“š' }
];

Object.assign(app, {
    currentCategory: null, // å½“å‰é€‰ä¸­çš„åˆ†ç±»ï¼ˆé¦–æ¬¡åŠ è½½æ—¶è‡ªåŠ¨é€‰æ‹©ç¬¬ä¸€ä¸ªï¼‰
    
    init() {
        this.initCommon();
        // å»¶è¿Ÿåˆå§‹åŒ–ï¼Œç¡®ä¿æ•°æ®å·²åŠ è½½
        setTimeout(() => {
            this.initAnnualPlan();
            this.render();
        }, 200);
    },

    // åˆå§‹åŒ–å¹´åº¦è®¡åˆ’æ•°æ®
    initAnnualPlan() {
        // ç¡®ä¿ annualPlan å­—æ®µå­˜åœ¨
        if (!this.data.annualPlan) {
            this.data.annualPlan = [];
        }
        
        if (this.data.annualPlan.length === 0) {
            // é¦–æ¬¡ä½¿ç”¨ï¼Œåˆå§‹åŒ–æ•°æ®
            this.data.annualPlan = annualPlanTemplate.map((item, index) => ({
                id: Date.now() + index,
                ...item
            }));
            this.saveData();
        } else {
            // æ£€æŸ¥æ˜¯å¦æœ‰æ–°å¢çš„ä»»åŠ¡ï¼ˆé€šè¿‡æ¯”è¾ƒæ•°é‡ï¼‰
            if (this.data.annualPlan.length < annualPlanTemplate.length) {
                // åˆå¹¶æ–°ä»»åŠ¡
                annualPlanTemplate.forEach(template => {
                    const exists = this.data.annualPlan.find(p => 
                        p.category === template.category && p.name === template.name
                    );
                    if (!exists) {
                        this.data.annualPlan.push({
                            id: Date.now() + Math.random(),
                            ...template
                        });
                    }
                });
                this.saveData();
            }
        }
    },

    render() {
        const planList = document.getElementById('plan-list');
        const categoryTabs = document.getElementById('category-tabs');
        if (!planList || !categoryTabs) return;

        // ç¡®ä¿æ•°æ®å·²åˆå§‹åŒ–
        if (!this.data.annualPlan || this.data.annualPlan.length === 0) {
            planList.innerHTML = '<div style="text-align:center; padding:40px; color:var(--text-light);">æ­£åœ¨åŠ è½½è®¡åˆ’æ•°æ®...</div>';
            return;
        }

        // æŒ‰åˆ†ç±»åˆ†ç»„
        const categories = {};
        this.data.annualPlan.forEach(item => {
            if (!categories[item.category]) {
                categories[item.category] = [];
            }
            categories[item.category].push(item);
        });

        // æ¸²æŸ“åˆ†ç±»æ ‡ç­¾ï¼ˆä¸åŒ…å«"å…¨éƒ¨"ï¼‰
        const allCategories = Object.keys(categories).sort();
        
        // å¦‚æœå½“å‰åˆ†ç±»ä¸ºç©ºæˆ–è€…æ˜¯"å…¨éƒ¨"ï¼Œé»˜è®¤é€‰æ‹©"ä¼‘é—²å¨±ä¹"ï¼Œå¦‚æœæ²¡æœ‰åˆ™é€‰æ‹©ç¬¬ä¸€ä¸ªåˆ†ç±»
        if (!this.currentCategory || this.currentCategory === 'å…¨éƒ¨') {
            if (categories['ä¼‘é—²å¨±ä¹']) {
                this.currentCategory = 'ä¼‘é—²å¨±ä¹';
            } else if (allCategories.length > 0) {
                this.currentCategory = allCategories[0];
            }
        }
        
        let tabsHtml = '';
        allCategories.forEach(cat => {
            const isActive = cat === this.currentCategory;
            const count = categories[cat]?.length || 0;
            tabsHtml += `
                <div class="plan-category-tab ${isActive ? 'active' : ''}" onclick="app.switchCategory('${cat}')">
                    ${cat} ${count > 0 ? `(${count})` : ''}
                </div>
            `;
        });
        categoryTabs.innerHTML = tabsHtml;

        // æ ¹æ®å½“å‰åˆ†ç±»è¿‡æ»¤æ•°æ®ï¼ˆåªæ˜¾ç¤ºå½“å‰åˆ†ç±»ï¼‰
        let displayItems = [];
        if (categories[this.currentCategory]) {
            displayItems.push({ category: this.currentCategory, items: categories[this.currentCategory] });
        }

        // æ¸²æŸ“è®¡åˆ’åˆ—è¡¨
        let html = '';
        displayItems.forEach(({ category, items }) => {
            const completed = items.filter(i => i.completed).length;
            const total = items.length;
            
            html += `
                <div class="plan-category">
                    <div class="category-header">
                        <div class="category-title">${category}</div>
                        <div class="category-progress">${completed}/${total}</div>
                    </div>
            `;
            
            items.forEach(item => {
                const isCompleted = item.completed;
                const progress = item.target > 1 ? `${item.current}/${item.target}` : '';
                const progressPercent = item.target > 1 ? Math.min(100, (item.current / item.target) * 100) : (isCompleted ? 100 : 0);
                
                html += `
                    <div class="plan-item ${isCompleted ? 'completed' : ''}">
                        <div class="plan-item-content" onclick="app.togglePlanItem(${item.id})">
                            <div class="plan-checkbox ${isCompleted ? 'checked' : ''}"></div>
                            <span class="plan-name">${item.icon} ${item.name}</span>
                            <button class="btn-delete-plan" onclick="event.stopPropagation(); app.deletePlan(${item.id})" title="åˆ é™¤è®¡åˆ’">ğŸ—‘ï¸</button>
                        </div>
                        ${item.target > 1 ? `
                            <div class="plan-actions">
                                <div class="plan-progress-bar">
                                    <div class="plan-progress-fill" style="width: ${progressPercent}%"></div>
                                </div>
                                <span class="plan-progress">${progress}</span>
                                ${!isCompleted ? `<button class="btn-add-progress" onclick="event.stopPropagation(); app.addProgress(${item.id})">+1</button>` : ''}
                            </div>
                        ` : ''}
                    </div>
                `;
            });
            
            html += `</div>`;
        });
        
        if (html === '') {
            html = '<div style="text-align:center; padding:40px; color:var(--text-light);">è¯¥åˆ†ç±»ä¸‹æš‚æ— è®¡åˆ’</div>';
        }
        
        planList.innerHTML = html;
        
        // æ›´æ–°æ€»ä½“è¿›åº¦
        this.updateOverallProgress();
    },

    // åˆ‡æ¢åˆ†ç±»
    switchCategory(category) {
        this.currentCategory = category;
        this.render();
    },

    // åˆ‡æ¢å•æ¬¡ä»»åŠ¡å®ŒæˆçŠ¶æ€
    togglePlanItem(id) {
        const item = this.data.annualPlan.find(p => p.id === id);
        if (!item) return;
        
        // å¦‚æœæ˜¯é˜¶æ®µæ€§ä»»åŠ¡ï¼ˆtarget > 1ï¼‰ï¼Œç‚¹å‡»ä¸åˆ‡æ¢å®ŒæˆçŠ¶æ€ï¼Œåªæ˜¾ç¤ºè¿›åº¦
        if (item.target > 1) {
            return;
        }
        
        // å•æ¬¡ä»»åŠ¡ï¼šåˆ‡æ¢å®ŒæˆçŠ¶æ€
        item.completed = !item.completed;
        if (item.completed) {
            item.current = 1;
            uiManager.createPetal();
            uiManager.createPetal();
            this.showToast(`å¤ªæ£’äº†ï¼å®Œæˆäº†ï¼š${item.name} ğŸ‰`);
        } else {
            item.current = 0;
        }
        
        this.saveData();
    },

    // å¢åŠ é˜¶æ®µæ€§ä»»åŠ¡è¿›åº¦
    addProgress(id) {
        const item = this.data.annualPlan.find(p => p.id === id);
        if (!item || item.target <= 1) return;
        
        if (item.current < item.target) {
            item.current++;
            
            // æ£€æŸ¥æ˜¯å¦å®Œæˆ
            if (item.current >= item.target) {
                item.completed = true;
                uiManager.createPetal();
                uiManager.createPetal();
                uiManager.createPetal();
                this.showToast(`ğŸ‰ğŸ‰ğŸ‰ å®Œæˆäº†ï¼š${item.name}ï¼å¤ªå‰å®³äº†ï¼`);
            } else {
                this.showToast(`è¿›åº¦æ›´æ–°ï¼š${item.name} (${item.current}/${item.target}) âœ¨`);
            }
            
            this.saveData();
        }
    },

    // æ›´æ–°æ€»ä½“è¿›åº¦
    updateOverallProgress() {
        const total = this.data.annualPlan.length;
        let completed = 0;
        let totalProgress = 0;
        
        this.data.annualPlan.forEach(item => {
            if (item.completed) {
                completed++;
                totalProgress += 100;
            } else if (item.target > 1) {
                // é˜¶æ®µæ€§ä»»åŠ¡æŒ‰ç™¾åˆ†æ¯”è®¡ç®—
                totalProgress += (item.current / item.target) * 100;
            }
        });
        
        const percent = total > 0 ? Math.round(totalProgress / total) : 0;
        
        const valueEl = document.getElementById('overall-progress-value');
        const fillEl = document.getElementById('overall-progress-fill');
        
        if (valueEl) valueEl.innerText = `${percent}%`;
        if (fillEl) fillEl.style.width = `${percent}%`;
    },

    // æ˜¾ç¤ºæ–°å¢è®¡åˆ’å¼¹çª—
    showAddPlanModal() {
        document.getElementById('add-plan-modal').style.display = 'flex';
        document.getElementById('plan-name-input').value = '';
        document.getElementById('plan-target-input').value = '1';
        document.getElementById('plan-icon-input').value = 'ğŸ“';
        // å¦‚æœå½“å‰æœ‰é€‰ä¸­åˆ†ç±»ï¼Œé»˜è®¤è®¾ç½®ä¸ºè¯¥åˆ†ç±»
        if (this.currentCategory !== 'å…¨éƒ¨') {
            document.getElementById('plan-category-select').value = this.currentCategory;
        }
        document.getElementById('plan-name-input').focus();
    },

    // æ·»åŠ æ–°è®¡åˆ’
    addNewPlan() {
        const name = document.getElementById('plan-name-input').value.trim();
        const category = document.getElementById('plan-category-select').value;
        const target = parseInt(document.getElementById('plan-target-input').value) || 1;
        const icon = document.getElementById('plan-icon-input').value.trim() || 'ğŸ“';

        if (!name) {
            alert('è¯·è¾“å…¥è®¡åˆ’åç§°ï¼');
            return;
        }

        if (target < 1) {
            alert('ç›®æ ‡æ•°é‡å¿…é¡»å¤§äº0ï¼');
            return;
        }

        // æ·»åŠ åˆ°æ•°æ®
        if (!this.data.annualPlan) {
            this.data.annualPlan = [];
        }

        const newPlan = {
            id: Date.now(),
            category: category,
            name: name,
            target: target,
            current: 0,
            completed: false,
            icon: icon
        };

        this.data.annualPlan.push(newPlan);
        this.saveData();

        // å…³é—­å¼¹çª—
        document.getElementById('add-plan-modal').style.display = 'none';
        
        // åˆ‡æ¢åˆ°æ–°è®¡åˆ’æ‰€å±çš„åˆ†ç±»
        this.currentCategory = category;
        
        this.showToast('è®¡åˆ’å·²æ·»åŠ ï¼âœ¨');
        this.render();
    },

    // åˆ é™¤è®¡åˆ’
    deletePlan(id) {
        const item = this.data.annualPlan.find(p => p.id === id);
        if (!item) return;

        if (confirm(`ç¡®å®šè¦åˆ é™¤è®¡åˆ’"${item.name}"å—ï¼Ÿ`)) {
            this.data.annualPlan = this.data.annualPlan.filter(p => p.id !== id);
            this.saveData();
            this.showToast('è®¡åˆ’å·²åˆ é™¤');
            this.render();
        }
    }
});

app.init();
</script>
</body>
</html>
